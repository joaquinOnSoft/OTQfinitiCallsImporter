# OTQfinitCallsImporter

Utility to generate a .xls file to be used as input in the **OpenText Qfiniti Data Importer**, from a folder structure provided by a client. It usually contains an Excel or CSV file generated by a 3rd party software like **Verint**, **Genesys** or **NICE**.

> **NOTE**: It assumes an input folder structure that contains an excel file (.xls) with the metadata associated with the call recording files.  

# OTQfinitCallsImporter Overview
Usually **3rd party software** like Genesys, NICE or Verint exports an Excel or CSV file with the metadata associated with each call recording. We call **INPUT file** to this file.

**OpenText Qfiniti Data Importer** requires and Excel file  with the metadata associated with each call recording. We call **OUTPUT file** to this file. 

**OTQfinitCallsImporter** requires a **JSON configuration file** that defines the mapping between the input fields and the output field. Not all the fields should be mapped, some of them are populated with a default value, an automatically generated value, or simply ignored.

On the other hand, other clients just provide a folder which contains call recordings in .wav format. In this scenario  **OTQfinitCallsImporter** can generate the **OUTPUT file** based on the metadata contained in each .wav file. In case we are working in a Prove of Concept (POC), it can generated some metadata randomly for each call, like ANI, DNIS, Team Member or Group.

The output file generated by **OTQfinitCallsImporter** will be used as input by **OpenText Qfiniti Data Importer**, so **OTQfinitCallsImporter** is a format conversion tool, not an imported by itself. 

```
   MAPPING between 3rd party output excel file and  OpenText Qfiniti Data Importer excel input file
   	
   +--------------------+                                +-----------------------+
   | Excel generated    |                                | Excel generated       |
   |       by           | ------------------------------>|       by              |
   | 3rd party software |     OTQfinitCallsImporter      | OTQfinitCallsImporter |
   +--------------------+                                +-----------------------+
                                       /\   
                                        |
                                        |
                                        |
                              +--------------------+ 
                              |  JSON config file  |
                              |                    | 
                              |   Fields mapping   | 
                              +--------------------+                                      
```

```
   Folder with call recordings used as input to generate the excel file required as input by 
   OpenText Qfiniti Data Importer
   	__________
   /           \________                                 +-----------------------+
   | Call recordings    |                                | Excel generated       |
   |       in           | ------------------------------>|       by              |
   | .wav format        |     OTQfinitCallsImporter      | OTQfinitCallsImporter |
   +--------------------+                                +-----------------------+
      |                                 /\   
      +- call01.wav                     |
      +- call01.wav                     |
      +- call01.wav                     |
      + ...                             |
      +- callNN.wav                     |
                                        |
                                        |
                              +--------------------+ 
                              |  JSON config file  |
                              |                    | 
                              |   Fields mapping   | 
                              +--------------------+                                      
```


## Command line execution 

This utility is distributed as a runnable .jar file.

These are the accepted parameters:

usage: javac -jar OTQfinitiCallsImporter-20.2.jar
 * **-c**, **--config <arg>**				(Required) JSON config name which defines the field mapping between the 3rd party metadata file and the .xls input file required by **OpenText Qfiniti Data Importer**
 * **-o**, **--output <arg>**		(Optional) Output file name. 'calls.xlsx' by default
 * **-f**, **--flatten <arg>**		(Optional) Flatten folder structure in the destiny folder. OTHER PARAMETERS WILL IGNORED except 'p' or 'path'
 * **-p**, **--path <arg>**			(Required) UNC Path to the call recordings files (.wav files) 


### Example of invocation

```
$ java -jar OTQfinitiCallsImporter-20.2.jar -c client_i_mapping.json -o call_recordinds.xls
```

### Output

Example of Excel file generated by this utility:

```
$ java -jar OTQfinitiCallsImporter-20.2.jar -c client_i_mapping.json -o call_recordinds.xls
```

| Path_Name                  | Name                      | Date_time           | duration      |
| -------------------------- | ------------------------- | ------------------- | ------------- | 
| \\\\MY_SERVER\\recordings  | file_example_WAV_1MG.wav  | 11/07/2019 23:15:43 | 33            |
| \\\\MY_SERVER\\recordings  | file_example_WAV_2MG.wav  | 11/07/2019 23:15:43 | 29            |         

## JSON mapping configuration file 

The application requires a JSON mapping configuration file as input.

Let'see an example:

```json
{
	"inputType": "xls",
	"fieldFiller": [
		{
			"oname": "Path_Name",
			"ovalue": "C:\\Users\\jgarzonpena\\eclipse-workspace\\OTQfinitiCallsImporter\\src\\test\\resources\\client-i\\samples"
		},
		{
			"oname": "group_hierarchy",
			"filler": "com.opentext.qfiniti.importer.io.filler.GroupHierarchyFiller"
		}		
	],
	"fieldMapping": [
		{
			"iname": "Media Type",
			"itype": "String",
			"mapped": "false"
		},
		{
			"iname": "Recording Type",
			"itype": "String",
			"mapped": "false"
		},
		{
			"iname": "Recording ID",
			"itype": "string",
			"mapped": "false"  
		},
		{
			"iname": "Date/Time",
			"itype": "String",		 
			"mapped": "true",
			"oname": "Date_Time",
			"otype": "String",
			"transformer": "com.opentext.qfiniti.importer.io.transformer.DateMMddyyyyhhmmssaTransformer"
		},
		{
			"iname": "Recording Length",
			"itype": "String",
			"mapped": "true",
			"oname": "duration",
			"otype": "String",
			"transformer": "com.opentext.qfiniti.importer.io.transformer.HoursMinutesSecondsToSecondsTransformer"			
		},
		{
			"iname": "Direction",
			"itype": "string",
			"mapped": "false"  
		},
		{
			"iname": "Initiator Interaction Address",
			"itype": "string",
			"mapped": "true",
			"oname": "ANI",
			"otype": "String" 
		},
		{
			"iname": "Interaction Address",
			"itype": "string",
			"mapped": "true",
			"oname": "dnis",
			"otype": "String"  
		},
		{
			"iname": "Local Party Name",
			"itype": "string",
			"mapped": "true",
			"oname": "Team_Member_Name",
			"otype": "String",
			"transformer": "com.opentext.qfiniti.importer.io.transformer.LocalPartyName2TeamMemberNameTransformer"					
		},
		{
			"iname": "Scoring User",
			"itype": "string",
			"mapped": "false"  
		},
		{
			"iname": "Scoring Status",
			"itype": "string",
			"mapped": "false"  
		},
		{
			"iname": "Queue",
			"itype": "string",
			"mapped": "false"  
		},
		{
			"iname": "Interaction ID Key",
			"itype": "string",
			"mapped": "true",
			"oname": "File_Name",
			"otype": "String",
			"transformer": "com.opentext.qfiniti.importer.io.transformer.InteractionIdKey2FileNameTransformer"								  
		},
		{
			"iname": "Initiation Policy",
			"itype": "string",
			"mapped": "false"  
		},
		{
			"iname": "Related Recordings",
			"itype": "string",
			"mapped": "false"  
		},
		{
			"iname": "Customer Keyword Score",
			"itype": "string",
			"mapped": "false"  
		},
		{
			"iname": "Agent Keyword Score",
			"itype": "string",
			"mapped": "false"  
		},
		{
			"iname": "Total Keyword Score",
			"itype": "string",
			"mapped": "false"  
		}		
	]
}
```  

There are 3 main properties:
   - **inputType**: Input type. Possible values:
      - **xls**: Excel file
      - **csv**: CSV file (COMING SOON, not currently available)
   - **fieldFiller**: List of field fillers which provide a default or an automatically generated value for a given field. These are the possible values of a field filler:
      - **oname**: (Required) Output field name
      - **ovalue**: (Optional) Output default value
      - **filler**: (Optional) Class that extends **com.opentext.qfiniti.importer.io.filler.AbstractFiller** and provides an automatically generated value for this field.
      > **NOTE**: 'ovalue' field will be ignored when 'filler' property is present.
   - **fielMapping**: List of field mappings which provide a mapping between the input field and the output field. These are the possible values:
      - **iname**: (Required) Input field name
      - **itype**: Input data type. Default value "string"
      - **mapped**: Flag to indicate if the input file is exported to the ouput file
      - **oname**: (Required) Output field name
      - **otype**: Output data type. Default value "string"
      - **transformer**: (Optional) Class that implements the interface **com.opentext.qfiniti.importer.io.transformer.ITransformer** and provides some kind of processing/data manipulation for this field.


### Valid output field names
These are the valid output field names admitted by  **OpenText Qfiniti Data Importer**

   - **Path_Name**: **UNC path.**
   
> **WARNING**:  **UNC** (Universal Naming Convention) is a standard for identifying servers, printers and other resources in a network.
> Qfiniti Data Importer requires a UNC path to work properly 

   - **Date_Time**: Recording date & time in format 'dd/MM/yyyy HH:mm:ss'
   - **Team_Member_Name**: Team member name in format:
      &lt;1st FAMILY NAME&gt; &lt;2nd FAMILY NAME&gt;, &lt;NAME&gt;
      or
      &lt;1st FAMILY NAME&gt;, &lt;NAME&gt;
   - **duration**: Call recording duration in seconds
   - **group_hierarchy**: Group hierarchy (Group name)
   - **dnis**: Phone number used by the client to call to the Call Center.
   - **ANI**:	
   - **File_Name**: Call recording file name (usually a .wav file)
 
    
### Available field fillers

#### com.opentext.qfiniti.importer.io.filler.AniFiller
Generate a random ANI (Client phone number)

#### com.opentext.qfiniti.importer.io.filler.DnisFiller
Generate a random DNIS (Call type)

#### com.opentext.qfiniti.importer.io.filler.GroupHierarchyFiller
Generate a fix Group Hierarchy name: "Client-i"


### Available field transformers

#### com.opentext.qfiniti.importer.io.transformer.DateMMddyyyyhhmmssaTransformer
Transforms a date from 'MM/dd/yyyy hh:mm:ss a' to format 'dd/MM/yyyy HH:mm:ss'

#### com.opentext.qfiniti.importer.io.transformer.HoursMinutesSecondsToSecondsTransformer
Transforms a duration expressed as hh:mm:ss to a number of seconds

#### com.opentext.qfiniti.importer.io.transformer.InteractionIdKey2FileNameTransformer
Generates a call recording file name from an id, e.g. from and Id like 2001788444D0191021 will generate a file name like:

   IRCall_2001788444D0191021.wav
   
#### com.opentext.qfiniti.importer.io.transformer.LocalPartyName2TeamMemberNameTransformer
Transforms a team member name from one of these formats:

   - 1st_NAME 1st_FAMILY_NAME 2nd_FAMILY_NAME
   - 1st_NAME 2nd_NAME 1st_FAMILY_NAME 2nd_FAMILY_NAME
   - 1st_NAME 1st_FAMILY_NAME

to one of these:

   - 1st_FAMILY_NAME 2nd_FAMILY_NAME, 1st_NAME 
   - 1st_FAMILY_NAME 2nd_FAMILY_NAME, 1st_NAME 2nd_NAME
   - 1st_FAMILY_NAME, 1st_NAME 